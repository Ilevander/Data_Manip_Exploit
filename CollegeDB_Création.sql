Create database CollegeDB;
GO
use CollegeDB;
GO

CREATE TABLE Course(
	CourseId char(8) NOT NULL PRIMARY KEY,
	CourseTitle varchar(50) NOT NULL,
	Cost decimal(6,2) NULL,
	Credit_Hours int NULL);

CREATE TABLE Student(
	Stdno char(5) NOT NULL PRIMARY KEY,
	Firstname varchar(25) NOT NULL,
	Lastname varchar(25) NOT NULL,
	Depart char(4) NULL);

CREATE TABLE Semester(
	semesterID char(5) NOT NULL PRIMARY KEY ,
	semestercode int NULL,
	semesterYear int NULL);

CREATE TABLE Register(
	Stdno char(5) NOT NULL foreign key references Student(Stdno),
	courseID char(8) NOT NULL foreign key references Course(courseID),
	semesterID char(5) NOT NULL foreign key references Semester(semesterID),
	grade char(2) NULL,
	mark decimal(4, 2) NULL
	constraint pk_Register primary key(Stdno,courseID,semesterID) );

INSERT into Student (Stdno, Firstname, Lastname, Depart) VALUES ('S0001', 'Malak', 'Ben', 'CS  ');
INSERT into Student (Stdno, Firstname, Lastname, Depart) VALUES  ('S0201', 'Sofia', 'OL', 'IT  ');
INSERT into Student (Stdno, Firstname, Lastname, Depart) VALUES  ('S0211', 'Ali', 'Ahmed', 'CS  ');
INSERT into Student (Stdno, Firstname, Lastname, Depart) VALUES  ('S0421', 'Nour','Farah', N'IT  ');
INSERT into Student (Stdno, Firstname, Lastname, Depart) VALUES  ('S0711','Khaled', 'Bel', N'CS  ');
GO

INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUES ('CS1301  ', 'Programming 1', CAST(5000.00 AS Decimal(6, 2)), 3);
INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUES ('CS2301  ', 'Programming 2', CAST(7000.00 AS Decimal(6, 2)), 3);
INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUES ('CSC152  ', 'C Programming', CAST(8200.50 AS Decimal(6, 2)), 4);
INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUES ('CSC153  ', 'Object Oriented Programming', CAST(8480.00 AS Decimal(6, 2)), 4);
INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUEs ('IS3511  ', 'Database 2', CAST(7530.00 AS Decimal(6, 2)), 2);
INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUEs ('IT124   ', 'Java Programming', CAST(7680.00 AS Decimal(6, 2)), 3);
INSERT into Course (CourseId, CourseTitle, Cost, Credit_Hours) VALUES ('IT125   ', 'Database 1', CAST(6435.50 AS Decimal(6, 2)), 3);
GO

INSERT into Semester (semesterID, semestercode, semesterYear) VALUES ('SM01 ', 1, 2012);
INSERT into Semester (semesterID, semestercode, semesterYear) VALUES ('SM02 ', 2, 2012);
INSERT into Semester (semesterID, semestercode, semesterYear) VALUES ('SM03 ', 1, 2013);
INSERT into Semester (semesterID, semestercode, semesterYear) VALUES ('SM04 ', 2, 2013);
GO

INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0001', 'CSC152  ', 'SM02 ', 'A ', CAST(92.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0001', 'IS3511  ', 'SM02 ', 'B+', CAST(80.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0001', 'IT125   ', 'SM01 ', 'A+', CAST(96.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0201', 'CS1301  ', 'SM01 ', 'C ', CAST(70.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0201', 'CS2301  ', 'SM02 ', 'C+', CAST(75.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0201', 'CSC153  ', 'SM01 ', 'D+', CAST(65.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0201', 'IT124   ', 'SM01 ', 'A+', CAST(98.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0201', 'IT125   ', 'SM02 ', 'B+', CAST(87.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0211', 'CSC153  ', 'SM01 ', 'F ', CAST(50.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0421', 'IS3511  ', 'SM03 ', 'D+', CAST(65.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0421', 'IT124   ', 'SM02 ', 'F ', CAST(57.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0421', 'IT125   ', 'SM02 ', 'B ', CAST(84.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0711', 'CSC152  ', 'SM01 ', 'F ', CAST(55.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0711', 'CSC152  ', 'SM03 ', 'C+', CAST(77.00 AS Decimal(4, 2)))
INSERT into Register (Stdno, courseID, semesterID, grade, mark) VALUES ('S0711', 'IS3511  ', 'SM03 ', 'A+', CAST(95.00 AS Decimal(4, 2)))
GO
--LOrque la sous requete retourne plusieurs chose ou bien plusieurs condition on utilise le IN.....
-----------------------------------------------------------------------------------------------
SELECT firstname,lastname,r.mark FROM Student as s,Register as r 
where r.mark = (select max(mark) from Register as r inner join Student as s on s.Stdno=r.Stdno);
-----------------------------------------------------------------------------------------------
SELECT s.stdno,s.firstname,s.lastname,r.mark from Student as s
inner join Register r
on s.Stdno=r.Stdno
where r.mark > (select AVG(mark) from Register);
-----------------------------------------------------------------------------------------------
